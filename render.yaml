# =========================================
# ğŸš€ Render Deploy Configuration (Stable & Working)
# =========================================
services:
  - type: web
    name: ecommerce-prediction-api
    env: python
    plan: free
    region: singapore

    # -------------------------------
    # ğŸ“ Root Directory
    # -------------------------------
    # âœ… Renderê°€ ì—¬ê¸°ì„œ build & runì„ ìˆ˜í–‰í•˜ë„ë¡ ì„¤ì •
    rootDirectory: Purchase_Prediction_System

    # -------------------------------
    # ğŸ§± Build commands
    # -------------------------------
    buildCommand: |
      apt-get update && apt-get install -y cargo rustc
      pip install --upgrade pip
      pip install -r api_requirements.txt

    # -------------------------------
    # â–¶ï¸ Start command
    # -------------------------------
    # âœ… ml_pipeline ê²½ë¡œ ê¸°ì¤€ìœ¼ë¡œ FastAPI ì‹¤í–‰
    startCommand: uvicorn ml_pipeline.app.serve_model:app --host 0.0.0.0 --port $PORT

    # -------------------------------
    # ğŸŒ¿ Environment variables
    # -------------------------------
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.10          # âœ… Python 3.11ë¡œ ì˜¬ë¦¬ë©´ Feast í˜¸í™˜ ë¬¸ì œ í•´ê²°ë¨
      - key: FEAST_REPO_PATH
        value: /opt/airflow/feature_repo
      - key: MINIO_ENDPOINT
        value: http://127.0.0.1:9900
      - key: BUCKET
        value: model-store
      - key: PREFIX
        value: session-purchase
      - key: ENVIRONMENT
        value: production
