# =========================================
# 🚀 Render Deploy Configuration
# =========================================
services:
  - type: web
    name: ecommerce-prediction-api
    env: python
    region: singapore
    plan: free  # 필요 시 'starter' 이상으로 변경

    # -------------------------------
    # 🧱 빌드 단계
    # -------------------------------
    buildCommand: |
      apt-get update && apt-get install -y cargo rustc
      pip install --upgrade pip
      pip install --no-cache-dir -r Purchase_Prediction_System/api_requirements.txt

    # -------------------------------
    # ▶️ 실행 명령
    # -------------------------------
    startCommand: uvicorn Purchase_Prediction_System.ml_pipeline.app.serve_model:app --host 0.0.0.0 --port $PORT

    # -------------------------------
    # 🌿 환경 변수
    # -------------------------------
    envVars:
      - key: FEAST_REPO_PATH
        value: /opt/airflow/feature_repo
      - key: MINIO_ENDPOINT
        value: http://127.0.0.1:9900
      - key: BUCKET
        value: model-store
      - key: PREFIX
        value: session-purchase
      - key: PYTHON_VERSION
        value: 3.10.11
